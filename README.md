# REALIA - Browser MVP (仮リリース用)

目的：
- 「商業区画で出会う」→「DM」→（Phase1: 外部URL生成）「通話」導線の **ブラウザ動作チェック**
- スマホ中心UI（下部タブ）＋ PC強化（3ペイン）の土台

## できること（v0.1）
- ゲスト入室（表示名）
- 簡易マップで位置共有（タップ/ドラッグで移動）
- 近くの人リスト（半径調整）
- エリアチャット（商業区画/ビジネス特区/イベント）
- 1対1 DM（相手をクリック）
- オンライン一覧、ステータス切替（商談OK/取り込み中/離席）

※通話は Phase1 として「外部URL方式（Jitsiリンク自動生成）」を実装済み。DM相手と共有されます。

## ローカル起動（推奨）
1) Backend
```bash
cd backend
npm i
npm run dev
```

2) Frontend
```bash
cd frontend
npm i
# 必要なら .env を作って VITE_BACKEND_URL を設定
npm run dev
```

- Frontend: http://localhost:5173
- Backend: http://localhost:8787/health

## 動作チェックのコツ
- ブラウザを「通常タブ + シークレット」などで2つ開いて、別名で入室してください
- マップ上で近づくと「近くの人」に出ます → DM ができます

## 仮リリース（例）
- フロント：Netlify / Vercel などの静的ホスティング
- バックエンド：Render / Fly.io / Railway 等で Node をホスト
- フロントの `VITE_BACKEND_URL` をバックエンドURLに変更してビルド

### フロントのビルド
```bash
cd frontend
npm run build
```
dist/ をデプロイ

### バックエンドの注意
- `CLIENT_ORIGIN` をフロントURLに設定
- WebSocketを許可するホスティングを選ぶ

## 次の実装（v0.2候補）
- 「会議室URL生成」（Google Meet/Zoomの手動登録→自動発行へ）
- 名刺UI（会社/業種/対応エリア/ポートフォリオ）
- PC：案件ボード（共同受注）と提携申請ボタン
- 3D（軽量WebGL）へ段階移行

## v0.3（今回追加）
- 名刺（会社/役割/タグ/対応エリア/Web）
- 提携申請（受信箱）
- 案件ボード（共同受注の投稿/一覧/削除）

## v0.4（今回追加）
- ブロック/解除
- 通報
- 迷惑対策レート制限（DM/投稿/提携申請）
- 案件検索/フィルタ（キーワード/タグ/地域っぽい語）

## v0.5（今回追加）
- 永続化（サーバ再起動でも名刺/案件/ブロック/通報が残る）
- 運営向け管理画面（通報一覧）
- ブロックした相手を一覧から非表示

## v0.6（今回追加）
- SQLite永続化（DB_FILE=realia.db）
- 安定したユーザーID（deviceId）
- 管理画面：通報をResolve可能

## v0.7（今回追加）
- PIN（簡易ログイン/なりすまし対策）
- PIN設定済みユーザーはログイン時PIN必須
- 表示名変更（PIN検証＋クールダウン）
- 提携受信箱のDB復元

## v0.8（今回追加）
- 一般ユーザー依頼（自然文）
- AI（ヒューリスティック）で加盟店をピックアップし通知
- 加盟店が提案を送れる（提案はユーザーに通知）

## v0.9（今回追加）
- 依頼/提案のステータス管理（sent/accepted/rejected, open/negotiating/won/lost/closed）
- ユーザーが提案を採用/見送り
- 加盟店が成約/失注を入力
- 管理画面メトリクス

## v1.0（今回追加）
- 依頼/提案画面をタブ整理（依頼作成/提案受信/加盟店依頼一覧/送信済み）
- 提案採用時にDMを自動で開く（オンライン時）
- DM画面に通話ボタン
- 管理CSV出力（requests/proposals）

## v1.1（今回追加）
- 通知箱（オフライン受信）：依頼通知/提案通知をDB保存して表示
- 加盟店審査（approvedのみ提案可/ピックアップ） + 管理画面 Members
- 依頼文のルール抽出（予算/カテゴリ/場所/ニーズ）

## v1.2
- 交渉ルーム（依頼ごと固定URL）
- 加盟店申請（運営承認）
- 通知の改善（バックエンド対応）

## v1.3
- フロント：通知箱表示（カード化）/ 加盟店申請フォーム
- 通話（call:create）と交渉ルーム（negotiation:get）の導線追加
- 管理画面 Applications 表示修正

## v1.4（今回追加）
- 提案採用後の交渉ルーム導線（取得/表示/自動オープン）
- 加盟店承認状態（memberStatus）をフロントに反映し、未承認は提案ボタンを抑止
- モード切替ボタン

## v1.5（今回追加）
- 交渉ルームを依頼カード側にも固定表示（依頼者/加盟店）
- 加盟店承認通知（member_approved）を通知箱に表示
- 加盟店申請フォームの入力チェック

## v1.6（今回追加）
- 通知箱の依頼通知→加盟店依頼一覧へジャンプ（該当依頼へスクロール）
- 承認済み（approved）のみ加盟店モードが有効（未承認は自動で一般ユーザー扱い）
- 採用済み提案から交渉ルームを復元（requestIdベース）

## v1.7（今回追加）
- 通知箱の提案通知→提案受信へジャンプ（該当提案へスクロール）
- 加盟店向け依頼一覧に検索フィルタ
- 監査ログ（admin/audit）

## v1.8（今回追加）
- 通知箱：未読のみフィルタ / まとめて既読
- 依頼一覧：カテゴリ/場所/予算フィルタ
- 監査ログ：actor(token末尾) と route を付与

## v1.9（今回追加）
- 通知箱：種類フィルタ
- 依頼一覧：ステータスフィルタ
- 管理：CSV出力UI（期間指定フォーム）

## v2.0（今回追加）
- 通知箱/提案受信：未読バッジ
- 管理：ExportUI（日付→ms）
- 管理：Pipeline可視化（/admin/pipeline）

## v2.1（今回追加）
- Pipeline：期間フィルタ（今週/今月/任意） + カテゴリ別/地域別
- 通知箱：未読バッジを種類別表示（R/P）

## v2.2（今回追加）
- Pipeline：カテゴリ×成約率 / 都道府県正規化
- 管理ExportUI：今週/今月/全期間ボタン

## v2.3（今回追加）
- Pipeline：カテゴリ/都道府県別の提案数・採用数
- 加盟店：自分の提案成約率ダッシュボード
- 依頼解析：市区町村ヒント→都道府県推定（簡易）

## v2.4（今回追加）
- 加盟店ダッシュボード：カテゴリ別採用率
- Pipeline：カテゴリ×都道府県ヒートマップ
- 依頼保存：location_text を都道府県推定で正規化（location_raw保存）

## v2.5（今回追加）
- 加盟店プロフィール：対応エリア/カテゴリを保持し、承認時に反映
- 加盟店依頼一覧：マッチングscore表示（エリア一致+2,カテゴリ一致+1）+ 対応エリア一致のみフィルタ
- Pipeline：加盟店対応エリア分布

## v2.6（今回追加）
- 依頼作成：都道府県推定サジェスト（確定ボタン）
- 自動ピックアップ：上位加盟店へ lead_candidate 通知
- マッチングスコア強化（都道府県/近隣/同一地方 + カテゴリ + 予算微加点）

## v2.7（今回追加）
- lead_candidate通知：『この依頼に提案する』ショートカット + 優先枠/順位表示
- 加盟店申請：対応エリアを都道府県チェックボックスで選択
- 自動ピックアップ：上位2社に優先枠（10分）情報を付与

## v2.8（今回追加）
- 優先枠（先着）を実装：上位2社のみが一定時間提案可能
- proposal:blocked イベントでUIに警告

## v3.0（今回：ブラウザ版の雰囲気チェック強化）
- 近未来・六本木風「Fashion District」UI（ネオンストリート＋ホログラム広告）
- AI MODE（β）: 店舗はAI接客／購入はモック（ローカル保存）
- 6店舗モデルケース＋商品ダミー
- デプロイ雛形: Netlify(frontend) / Render(backend)


## Deploy (Quick)

### 1) Backend (Render)
- Renderで new Web Service を作成
- Repository/Zipをアップロード後、`render.yaml` を利用（または手動設定）
- 環境変数:
  - `ADMIN_TOKEN`
  - `FRONTEND_URL`（NetlifyのURL）

### 2) Frontend (Netlify)
- Netlifyで new site from Git / Drag&Drop
- `frontend` をサイトルートにしてビルド
- `VITE_BACKEND_URL` を Render のバックエンドURLに設定（例: https://xxxxx.onrender.com）

### 3) 動作チェック
- フロントURLを開く → 「マップ」タブで六本木風ストリート表示
- 店舗ホログラムをタップ → 入店 → AI接客モック＋カート＋注文（モック）


## v3.1（今回：六本木感＆ホログラム広告の明確化）
- GATE PLAZA（入場演出）追加
- ホログラム広告3種の見た目差別化（FLOAT/WINDOW/LANDMARK）
- 店舗内UI：接客→商品→カートのステップ化
- 試着プレビュー（雰囲気用）

## v3.2（今回：六本木感をさらに強化）
- 建物シルエット＋ライトビーム＋サインで街の密度UP（軽量）
- ホログラム広告コピーを洗練（3行）＋WINDOWのスキャンラインアニメ
- AIコンシェルジュ（デモ）におすすめルート導線

## v3.3（今回：夜の六本木の空気感を強化）
- 路面のネオン反射（ウェット表現）
- EVENT SQUARE（空間だけ先行配置）＋ステージホログラム演出
- 店舗配置を通りのカーブに合わせて再配置（回遊感）
