<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>REALIA 3D Open World (A) - Complete</title>
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">R</div>
      <div class="brand-text">
        <div class="brand-title">REALIA</div>
        <div class="brand-sub">3D Open World / Third-Person (A) - Complete Demo</div>
      </div>
    </div>

    <div class="pills">
      <div class="pill" id="pillArea">Area: World (Select)</div>
      <div class="pill hint" id="pillHint">キャラを動かしてゲートへ（近づくと入場ボタン有効）</div>
    </div>
  </header>

  <main class="layout">
    <!-- ===== World ===== -->
    <section class="panel world-panel card">
      <div class="panel-head">
        <h1>オープンワールド（3D）</h1>
        <p>服を着た3Dキャラを三人称で操作します。スマホは左下スティック、PCはWASD。</p>
      </div>

      <div class="world-wrap">
        <canvas id="worldCanvas" aria-label="3d world"></canvas>

        <!-- minimap -->
        <div id="minimap" class="minimap card-lite">
          <canvas id="minimapCanvas" width="220" height="160"></canvas>
          <div class="legend">
            <span><i class="dot you"></i>あなた</span>
            <span><i class="dot gate"></i>ゲート</span>
            <span><i class="dot ai"></i>AI</span>
          </div>
        </div>

        <!-- joystick -->
        <div id="joystick" class="joystick card-lite" aria-label="joystick">
          <div class="joy-base"></div>
          <div class="joy-knob" id="joyKnob"></div>
        </div>

        <!-- enter button (never overlaps joystick) -->
        <button id="enterBtn" class="enter-btn" disabled>
          このエリアに入る
        </button>

        <!-- HUD chips -->
        <div class="hud-row card-lite">
          <button class="chip" id="btnReset">リセット</button>
          <button class="chip" id="btnTeleport1">ゲート1へ</button>
          <button class="chip" id="btnTeleport2">ゲート2へ</button>
          <button class="chip" id="btnTalk">話す（近くで有効）</button>
        </div>

        <div class="hud-help">
          操作：WASD/矢印 / 画面左下スティック（スマホ） / 近くで入場 / 近くで話す
        </div>
      </div>
    </section>

    <!-- ===== Chat ===== -->
    <section class="panel chat-panel card">
      <div class="panel-head">
        <h2>AI接客（簡易）</h2>
        <p class="muted">※いまはダミー応答。後で本物AI（API）に差し替え可能。</p>
      </div>

      <div id="chatLog" class="chat-log">
        <div class="msg system">
          <div class="role">System</div>
          <div class="bubble">
            起動しました。3Dキャラを動かしてゲート（緑）へ近づくと入場できます。AI（紫）に近づくと「話す」が有効です。
          </div>
        </div>
      </div>

      <div class="chat-input">
        <input id="chatText" type="text" placeholder="例：予算100万円で外壁塗装できる？" />
        <button id="chatSend">送信</button>
      </div>

      <div class="status card-lite">
        <div class="status-row"><span>現在エリア</span><b id="statusArea">World (Select)</b></div>
        <div class="status-row"><span>近くのNPC</span><b id="statusNpc">なし</b></div>
        <div class="status-row"><span>入場可能</span><b id="statusEnter">No</b></div>
      </div>

      <div class="note card-lite">
        <b>重要</b>
        <div class="muted" style="margin-top:6px; line-height:1.45">
          あなたの目標画像は「本格3Dゲーム（Unity/Unreal級）」です。<br/>
          まずはブラウザで成立する 3D三人称MVP を完成させ、次に背景・建物・光・霧を強化して近づけます。
        </div>
      </div>
    </section>
  </main>

  <!-- Modal: Area -->
  <div id="areaModal" class="modal" aria-hidden="true">
    <div class="modal-card card">
      <div class="modal-head">
        <h3 id="areaTitle">Area</h3>
        <button id="areaClose" class="xbtn" aria-label="close">×</button>
      </div>
      <p id="areaDesc" class="muted"></p>

      <div class="area-scene card-lite" id="areaScene">
        <div class="area-badge" id="areaBadge">NEON CITY</div>
        <div class="area-ai">
          <div class="avatar">AI</div>
          <div class="ai-text">
            <b id="areaAiName">AIコンシェルジュ</b>
            <div id="areaAiLine" class="muted">いらっしゃいませ。ご用件をどうぞ。</div>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button id="areaTalk" class="primary">AIに話しかける</button>
        <button id="areaBack" class="ghost">ワールドに戻る</button>
      </div>
    </div>
  </div>

  <script type="module" src="./app.js"></script>
</body>
</html>
